<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<div layout:fragment="content">
    <div class="space-y-6">
        <!-- Page Header -->
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div class="flex-1">
                    <h1 class="text-2xl font-bold text-gray-900">Leave Settings</h1>
                    <p class="text-sm text-gray-500 mt-1">Kelola saldo cuti karyawan per tahun</p>
                </div>
                <div class="flex items-center gap-3">
                    <form th:action="@{/leave-settings/bulk-init}" method="post" class="inline-flex">
                        <input type="hidden" name="year" th:value="${year}" />
                        <button type="submit"
                                onclick="return confirm('Inisialisasi leave balance untuk SEMUA karyawan tahun ' + ${year} + '?')"
                                class="inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors shadow-lg shadow-green-600/30">
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                            </svg>
                            Init Semua Karyawan
                        </button>
                    </form>
                    <a th:href="@{/leave-settings/add}"
                       class="inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Per Karyawan
                    </a>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div th:if="${success}" class="bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3">
            <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-sm text-green-800" th:text="${success}">Success message here</p>
        </div>

        <div th:if="${error}" class="bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3">
            <svg class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
            <p class="text-sm text-red-800" th:text="${error}">Error message here</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Total Employees -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-50 rounded-xl">
                        <svg class="w-6 h-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 5.472m0 0a9.09 9.09 0 00-5.963 1.584c-.466.297-.877.655-1.228 1.066m0 0A15.996 15.996 0 013 9.75c0-5.591 3.824-10.29 9-11.622 5.176 1.332 9 6.03 9 11.622m-9 5.25v.008v.008v-.008z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Karyawan</p>
                        <p class="text-2xl font-bold text-gray-900" th:text="${totalEmployees}">0</p>
                    </div>
                </div>
            </div>

            <!-- With Sufficient Balance -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <div class="flex items-center">
                    <div class="p-3 bg-green-50 rounded-xl">
                        <svg class="w-6 h-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Balance Cukup</p>
                        <p class="text-2xl font-bold text-gray-900" th:text="${withSufficientBalance}">0</p>
                    </div>
                </div>
            </div>

            <!-- Low Balance -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <div class="flex items-center">
                    <div class="p-3 bg-yellow-50 rounded-xl">
                        <svg class="w-6 h-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Balance Rendah</p>
                        <p class="text-2xl font-bold text-gray-900" th:text="${lowBalance}">0</p>
                    </div>
                </div>
            </div>

            <!-- Zero Balance -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                <div class="flex items-center">
                    <div class="p-3 bg-red-50 rounded-xl">
                        <svg class="w-6 h-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Balance Habis</p>
                        <p class="text-2xl font-bold text-gray-900" th:text="${zeroBalance}">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters & List Section -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
            <!-- Filters -->
            <div class="p-5 border-b border-gray-200">
                <form th:action="@{/leave-settings}" method="get" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Year Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Tahun</label>
                            <select name="year"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                <option value="2024" th:selected="${year == 2024}">2024</option>
                                <option value="2025" th:selected="${year == 2025}">2025</option>
                                <option value="2026" th:selected="${year == 2026}">2026</option>
                                <option value="2027" th:selected="${year == 2027}">2027</option>
                            </select>
                        </div>

                        <!-- Department Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Department</label>
                            <select name="departmentId"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                <option value="">Semua Department</option>
                                <option th:each="dept : ${departments}"
                                        th:value="${dept.id}"
                                        th:text="${dept.name}"
                                        th:selected="${departmentId != null && departmentId == dept.id}">Department Name</option>
                            </select>
                        </div>

                        <!-- Search Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">Cari Nama</label>
                            <input type="text"
                                   name="search"
                                   th:value="${search}"
                                   placeholder="Cari nama karyawan..."
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                        </div>
                    </div>

                    <!-- Filter Actions -->
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-500">
                            Showing <span class="font-medium text-gray-900" th:text="${balances != null ? balances.size() : 0}">0</span> leave balances
                        </div>
                        <div class="flex items-center gap-3">
                            <a th:href="@{/leave-settings}" class="text-sm text-gray-600 hover:text-gray-900 transition-colors">
                                Clear Filters
                            </a>
                            <button type="submit"
                                    class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 border border-blue-600 rounded-lg text-sm font-medium text-white hover:bg-blue-700 transition-all">
                                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                                </svg>
                                Apply Filters
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Leave Balances Table -->
            <div class="overflow-x-auto">
                <!-- Empty State -->
                <div th:if="${balances == null or #lists.isEmpty(balances)}" class="text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Tidak ada data leave balance</h3>
                    <p class="text-sm text-gray-500">Belum ada data leave balance untuk tahun <span th:text="${year}">2026</span></p>
                </div>

                <!-- Table -->
                <table th:if="${balances != null && !#lists.isEmpty(balances)}" class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Karyawan</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Department</th>
                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Jatah Tahunan</th>
                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Diambil</th>
                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Carry Forward</th>
                            <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Sisa Balance</th>
                            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <tr th:each="balance : ${balances}" class="hover:bg-gray-50 transition-colors">
                            <!-- Employee Info -->
                            <td class="px-6 py-4">
                                <div class="flex items-center">
                                    <div class="h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm">
                                        <span th:text="${#strings.substring(balance.employee.fullName, 0, 1)}">A</span>
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-gray-900" th:text="${balance.employee.fullName}">Name</div>
                                        <div class="text-xs text-gray-500" th:text="${balance.employee.nik}">NIK</div>
                                    </div>
                                </div>
                            </td>

                            <!-- Department -->
                            <td class="px-6 py-4">
                                <span class="text-sm text-gray-700" th:text="${balance.employee.department?.name}">-</span>
                            </td>

                            <!-- Annual Quota -->
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm font-medium text-gray-900" th:text="${balance.annualQuota}">12</span>
                                <span class="text-xs text-gray-500">hari</span>
                            </td>

                            <!-- Used -->
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm text-gray-700" th:text="${balance.used}">0</span>
                                <span class="text-xs text-gray-500">hari</span>
                            </td>

                            <!-- Carried Forward -->
                            <td class="px-6 py-4 text-right">
                                <div class="text-sm text-gray-700">
                                    <span th:text="${balance.carriedForward}">0</span>
                                    <span class="text-xs text-gray-500">hari</span>
                                </div>
                                <div th:if="${balance.carriedForwardExpiryDate}" class="text-xs text-gray-400">
                                    Exp: <span th:text="${#temporals.format(balance.carriedForwardExpiryDate, 'dd MMM')}"></span>
                                </div>
                            </td>

                            <!-- Remaining Balance -->
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm font-bold"
                                      th:class="${balance.totalAvailableBalance >= 6 ? 'text-green-600' : (balance.totalAvailableBalance > 0 ? 'text-yellow-600' : 'text-red-600')}"
                                      th:text="${balance.totalAvailableBalance}">12</span>
                                <span class="text-xs text-gray-500">hari</span>
                            </td>

                            <!-- Actions -->
                            <td class="px-6 py-4 text-center">
                                <a th:href="@{/leave-settings/edit/{employeeId}/{year}(employeeId=${balance.employee.id}, year=${year})}"
                                   class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-lg bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors">
                                    <svg class="w-3.5 h-3.5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                                    </svg>
                                    Edit
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

</html>
